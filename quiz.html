<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>CGS Quiz ‚Äî Capital Growth Training</title>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<link rel="stylesheet" href="shared.css">
<style>
.quiz-container {
  max-width: 700px;
  margin: 0 auto;
}

.quiz-header {
  text-align: center;
  margin-bottom: 30px;
}

.quiz-progress {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding: 10px 15px;
  background: #1a1a4a;
  border-radius: 8px;
}

.progress-text {
  color: #f7931a;
  font-weight: bold;
}

.progress-bar {
  flex: 1;
  height: 8px;
  background: #2a2a5a;
  border-radius: 4px;
  margin: 0 15px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #f7931a, #00d4aa);
  border-radius: 4px;
  transition: width 0.3s ease;
}

.scenario-card {
  background: linear-gradient(135deg, #1a1a4a, #2a2a5a);
  border: 2px solid #444;
  border-radius: 16px;
  padding: 25px;
  margin-bottom: 20px;
}

.scenario-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 15px;
  border-bottom: 1px solid #444;
}

.scenario-title {
  color: #f7931a;
  font-size: 1.2em;
  font-weight: bold;
}

.btc-price {
  text-align: right;
}

.btc-price .price {
  font-size: 1.3em;
  font-weight: bold;
  color: #fff;
}

.btc-price .change {
  font-size: 0.9em;
}

.btc-price .change.negative { color: #ff4444; }
.btc-price .change.positive { color: #00ff88; }
.btc-price .change.neutral { color: #888; }

.metrics-row {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  margin-bottom: 20px;
}

.metric-box {
  background: #0a0a1a;
  padding: 12px;
  border-radius: 8px;
  text-align: center;
}

.metric-box .label {
  font-size: 0.75em;
  color: #888;
  margin-bottom: 4px;
}

.metric-box .value {
  font-size: 1.1em;
  font-weight: bold;
}

.metric-box .value.safe { color: #00ff88; }
.metric-box .value.warning { color: #ffaa00; }
.metric-box .value.danger { color: #ff4444; }

.portfolio-section {
  margin-bottom: 20px;
}

.portfolio-section h4 {
  color: #00d4aa;
  font-size: 0.9em;
  margin-bottom: 10px;
}

.portfolio-bar {
  display: flex;
  align-items: center;
  margin-bottom: 8px;
  font-size: 0.85em;
}

.portfolio-bar .name {
  width: 80px;
  color: #888;
}

.portfolio-bar .bar-container {
  flex: 1;
  height: 20px;
  background: #0a0a1a;
  border-radius: 4px;
  margin: 0 10px;
  overflow: hidden;
}

.portfolio-bar .bar-fill {
  height: 100%;
  border-radius: 4px;
  transition: width 0.3s ease;
}

.portfolio-bar .bar-fill.growth { background: linear-gradient(90deg, #f7931a, #ff6b35); }
.portfolio-bar .bar-fill.stability { background: linear-gradient(90deg, #00d4aa, #00ff88); }
.portfolio-bar .bar-fill.gm { background: linear-gradient(90deg, #ff6b9d, #ff4444); }
.portfolio-bar .bar-fill.clmm { background: linear-gradient(90deg, #9966ff, #6633cc); }
.portfolio-bar .bar-fill.reserve { background: linear-gradient(90deg, #4488ff, #2266cc); }

.portfolio-bar .stats {
  width: 120px;
  text-align: right;
  color: #fff;
}

.portfolio-bar .pct {
  color: #f7931a;
  font-weight: bold;
}

.target-info {
  display: inline-block;
  font-size: 0.85em;
  color: #f7931a;
  background: #0a0a1a;
  padding: 6px 12px;
  border-radius: 6px;
  margin-top: 10px;
  border: 1px solid #f7931a44;
}

.target-info .label {
  color: #888;
  margin-right: 5px;
}

.clmm-range {
  font-size: 0.8em;
  color: #9966ff;
  margin-left: 90px;
  margin-top: -5px;
  margin-bottom: 8px;
}

.clmm-range.reached {
  color: #ff4444;
  font-weight: bold;
}

.question-box {
  background: #0a0a1a;
  border: 2px solid #f7931a;
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 20px;
}

.question-icon {
  font-size: 1.5em;
  margin-right: 10px;
}

.question-text {
  font-size: 1.1em;
  color: #fff;
}

.income-info {
  background: linear-gradient(135deg, #1a3a2a, #1a2a3a);
  border: 1px solid #00d4aa;
  border-radius: 8px;
  padding: 15px;
  margin-bottom: 15px;
}

.income-info .title {
  color: #00d4aa;
  font-weight: bold;
  margin-bottom: 10px;
}

.income-info .item {
  display: flex;
  justify-content: space-between;
  margin: 5px 0;
  font-size: 0.9em;
}

.options-table {
  display: table;
  width: 100%;
  border-spacing: 10px;
}

.options-row {
  display: table-row;
}

.options-cell {
  display: table-cell;
  width: 50%;
  vertical-align: top;
}

@media (max-width: 600px) {
  .options-table,
  .options-row,
  .options-cell {
    display: block;
    width: 100%;
  }
  .options-cell {
    margin-bottom: 10px;
  }
}

.option-btn {
  display: flex;
  align-items: flex-start;
  background: #1a1a4a;
  border: 2px solid #444;
  border-radius: 10px;
  padding: 15px;
  cursor: pointer;
  transition: all 0.2s ease;
  text-align: left;
  color: #e0e0e0;
  font-size: 0.95em;
  min-height: 80px;
  height: 100%;
  box-sizing: border-box;
  width: 100%;
}

.option-btn:hover {
  border-color: #f7931a;
  background: #2a2a5a;
}

.option-btn.selected {
  border-color: #f7931a;
  background: #2a2a5a;
}

.option-btn.correct {
  border-color: #00ff88;
  background: linear-gradient(135deg, #1a3a2a, #1a2a3a);
}

.option-btn.incorrect {
  border-color: #ff4444;
  background: linear-gradient(135deg, #3a1a1a, #2a1a2a);
}

.option-btn.disabled {
  pointer-events: none;
  opacity: 0.7;
}

.option-letter {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  background: #0a0a1a;
  border-radius: 50%;
  margin-right: 12px;
  font-weight: bold;
  color: #f7931a;
  flex-shrink: 0;
}

.option-text {
  flex: 1;
  line-height: 1.4;
  text-align: left;
}

.options-list {
  position: relative;
  overflow: hidden;
  margin-bottom: 20px;
}

#nextBtn {
  display: none;
  width: 100%;
  height: 50px;
  background: linear-gradient(90deg, #f7931a, #ff6b35);
  color: #fff;
  border: none;
  border-radius: 8px;
  font-size: 1.1em;
  font-weight: bold;
  cursor: pointer;
  margin: 0;
  padding: 0;
  line-height: 50px;
  text-align: center;
}

#nextBtn.visible {
  display: block;
}

/* Result Card */
.result-card {
  display: none;
  background: linear-gradient(135deg, #1a1a4a, #2a2a5a);
  border: 2px solid #f7931a;
  border-radius: 16px;
  padding: 30px;
  text-align: center;
}

.result-card.visible {
  display: block;
}

.result-score {
  font-size: 4em;
  font-weight: bold;
  color: #f7931a;
  margin: 20px 0;
}

.result-message {
  font-size: 1.2em;
  margin-bottom: 20px;
}

.result-message.excellent { color: #00ff88; }
.result-message.good { color: #00d4aa; }
.result-message.average { color: #ffaa00; }
.result-message.poor { color: #ff4444; }

.errors-section {
  background: #0a0a1a;
  border-radius: 10px;
  padding: 20px;
  margin: 20px 0;
  text-align: left;
}

.errors-section h4 {
  color: #ff6b9d;
  margin-bottom: 15px;
}

.error-category {
  display: flex;
  justify-content: space-between;
  padding: 8px 0;
  border-bottom: 1px solid #333;
}

.error-category:last-child {
  border-bottom: none;
}

.error-category .name {
  color: #888;
}

.error-category .count {
  color: #ff4444;
  font-weight: bold;
}

.result-actions {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-top: 20px;
}

.result-actions button {
  padding: 12px 20px;
}

.btn-secondary {
  background: linear-gradient(90deg, #444, #555);
}

.btn-share {
  background: linear-gradient(90deg, #5865F2, #4752C4);
}

/* Result image card (for screenshot) */
#resultImageCard {
  position: fixed;
  top: -9999px;
  left: -9999px;
  width: 400px;
  padding: 30px;
  background: linear-gradient(135deg, #0f0f23, #1a1a3e);
  border-radius: 16px;
}

#resultImageCard .header {
  text-align: center;
  color: #f7931a;
  font-size: 1.3em;
  margin-bottom: 20px;
}

#resultImageCard .score-circle {
  width: 120px;
  height: 120px;
  margin: 0 auto 20px;
  background: linear-gradient(135deg, #1a1a4a, #2a2a5a);
  border: 4px solid #f7931a;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2.5em;
  font-weight: bold;
  color: #fff;
}

#resultImageCard .message {
  text-align: center;
  font-size: 1.1em;
  margin-bottom: 20px;
}

#resultImageCard .errors {
  background: #0a0a1a;
  border-radius: 8px;
  padding: 15px;
  margin-bottom: 20px;
}

#resultImageCard .errors h5 {
  color: #ff6b9d;
  margin-bottom: 10px;
  font-size: 0.9em;
}

#resultImageCard .error-item {
  display: flex;
  justify-content: space-between;
  font-size: 0.85em;
  padding: 5px 0;
}

#resultImageCard .footer {
  text-align: center;
  color: #666;
  font-size: 0.8em;
  border-top: 1px solid #333;
  padding-top: 15px;
}

/* Start screen */
.start-screen {
  text-align: center;
  padding: 40px 20px;
}

.start-screen h2 {
  border: none;
  margin-bottom: 20px;
}

.start-screen .description {
  color: #888;
  margin-bottom: 30px;
  line-height: 1.6;
}

.start-screen .info-list {
  text-align: left;
  background: #1a1a4a;
  border-radius: 10px;
  padding: 20px;
  margin-bottom: 30px;
}

.start-screen .info-list li {
  margin: 10px 0;
  color: #aaa;
}

.start-btn {
  font-size: 1.2em;
  padding: 15px 40px;
}

/* Toast notification */
.toast {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: #00d4aa;
  color: #000;
  padding: 12px 24px;
  border-radius: 8px;
  font-weight: bold;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
  z-index: 1000;
}

.toast.visible {
  opacity: 1;
}
</style>
</head>
<body>
<div class="password-overlay" id="passwordOverlay">
<div class="password-box">
<h2>üéØ CGS Quiz</h2>
<input type="password" id="passwordInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
<button onclick="checkPassword()">–í–æ–π—Ç–∏</button>
<div class="error" id="passwordError">–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å</div>
</div>
</div>

<div class="container content-hidden" id="mainContent">
<div class="quiz-container">

<!-- Start Screen -->
<div class="start-screen" id="startScreen">
<h1>üéØ CGS Quiz</h1>
<h2>Capital Growth ‚Äî —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π</h2>
<p class="description">
–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö.<br>
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ—ë –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ Capital Growth.
</p>
<ul class="info-list">
<li>üìä 10 —Å–ª—É—á–∞–π–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤</li>
<li>‚è±Ô∏è –ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏</li>
<li>üìà –ö–∞—Ç–µ–≥–æ—Ä–∏–∏: GM Pool, CLMM, Stability, DCA, DeFi –¥–æ—Ö–æ–¥—ã</li>
<li>üéØ –¶–µ–ª—å: –ø–æ–Ω—è—Ç—å –∫–æ–≥–¥–∞ –∏ –∫–∞–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç—å</li>
</ul>
<button class="start-btn" onclick="startQuiz()">üöÄ –ù–∞—á–∞—Ç—å Quiz</button>
</div>

<!-- Quiz Screen -->
<div id="quizScreen" style="display: none;">
<div class="quiz-header">
<h1>üéØ CGS Quiz</h1>
</div>

<div class="quiz-progress">
<span class="progress-text" id="progressText">–í–æ–ø—Ä–æ—Å 1/10</span>
<div class="progress-bar">
<div class="progress-fill" id="progressFill" style="width: 10%"></div>
</div>
<span class="progress-text" id="categoryText">GM Pool</span>
</div>

<div class="scenario-card" id="scenarioCard">
<!-- Dynamic content -->
</div>

<div class="options-list" id="optionsList">
<!-- Dynamic options -->
</div>

<button id="nextBtn">–°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å ‚Üí</button>
</div>

<!-- Result Screen -->
<div class="result-card" id="resultCard">
<h2>üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã Quiz</h2>
<div class="result-score" id="resultScore">8/10</div>
<div class="result-message" id="resultMessage">–•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!</div>

<div class="errors-section" id="errorsSection">
<h4>–û—à–∏–±–∫–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:</h4>
<div id="errorsList"></div>
</div>

<div class="result-actions">
<button onclick="restartQuiz()">üîÑ –ü—Ä–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ</button>
<button class="btn-secondary" onclick="downloadImage()">üì• –°–∫–∞—á–∞—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É</button>
<button class="btn-share" onclick="copyImage()">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è Discord</button>
</div>
</div>

<!-- Hidden card for image generation -->
<div id="resultImageCard">
<div class="header">üéØ CGS Quiz Result</div>
<div class="score-circle" id="imgScore">8/10</div>
<div class="message" id="imgMessage">–•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!</div>
<div class="errors" id="imgErrors">
<h5>–û—à–∏–±–∫–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:</h5>
<div id="imgErrorsList"></div>
</div>
<div class="footer">cgs-simulation.vercel.app/quiz.html</div>
</div>

</div>

<div class="version">Quiz v1.0</div>
</div>

<div class="toast" id="toast">–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!</div>

<script src="shared.js"></script>
<script>
// Question database
const allQuestions = [
  // GM Pool questions (4)
  {
    id: 1,
    category: "gm",
    categoryName: "GM Pool",
    scenario: {
      btcPrice: 93000,
      btcChange: -7,
      hf: 1.58,
      ltv: 54,
      debt: 30000,
      portfolio: { growth: { value: 55800, pct: 58, target: 60 }, stability: { value: 40000, pct: 42, target: 40 } },
      yieldZone: { gm: { value: 11600, pct: 40 }, clmm: { value: 8700, pct: 30, rangeLow: 85000, rangeHigh: 105000 }, reserve: { value: 9000, pct: 30 } }
    },
    question: "–ü–∞–¥–µ–Ω–∏–µ -7%. –ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å GM Pool?",
    options: [
      { id: "a", text: "–ü—Ä–æ–¥–∞—Ç—å 30% GM ‚Üí WBTC –≤ –∑–∞–ª–æ–≥, USDC ‚Üí –∫—É–ø–∏—Ç—å GM", correct: true },
      { id: "b", text: "–ü—Ä–æ–¥–∞—Ç—å 30% GM ‚Üí WBTC –≤ –∑–∞–ª–æ–≥, USDC ‚Üí –ø–æ–≥–∞—Å–∏—Ç—å –¥–æ–ª–≥", correct: false },
      { id: "c", text: "–ü—Ä–æ–¥–∞—Ç—å 100% GM ‚Üí –≤—Å—ë –≤ –∑–∞–ª–æ–≥", correct: false },
      { id: "d", text: "–ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å, –∂–¥–∞—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è", correct: false }
    ]
  },
  {
    id: 2,
    category: "gm",
    categoryName: "GM Pool",
    scenario: {
      btcPrice: 85000,
      btcChange: -15,
      hf: 1.45,
      ltv: 59,
      debt: 30000,
      portfolio: { growth: { value: 51000, pct: 56, target: 60 }, stability: { value: 40000, pct: 44, target: 40 } },
      yieldZone: { gm: { value: 10800, pct: 40 }, clmm: { value: 8100, pct: 30, rangeLow: 85000, rangeHigh: 105000, reached: true }, reserve: { value: 9000, pct: 30 } }
    },
    question: "–ü–∞–¥–µ–Ω–∏–µ -15%. GM Pool —É–ø–∞–ª –Ω–∞ 8%. –ß—Ç–æ –¥–µ–ª–∞—Ç—å?",
    options: [
      { id: "a", text: "–ü—Ä–æ–¥–∞—Ç—å 100% GM ‚Üí WBTC –≤ –∑–∞–ª–æ–≥, USDC ‚Üí –∫—É–ø–∏—Ç—å GM –∑–∞–Ω–æ–≤–æ", correct: true },
      { id: "b", text: "–ü—Ä–æ–¥–∞—Ç—å 100% GM ‚Üí –≤—Å—ë –Ω–∞–ø—Ä–∞–≤–∏—Ç—å –≤ Stability Zone", correct: false },
      { id: "c", text: "–ü—Ä–æ–¥–∞—Ç—å 30% GM, –æ—Å—Ç–∞–ª—å–Ω–æ–µ –¥–µ—Ä–∂–∞—Ç—å", correct: false },
      { id: "d", text: "–î–µ—Ä–∂–∞—Ç—å GM, –∂–¥–∞—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã", correct: false }
    ]
  },
  {
    id: 3,
    category: "gm",
    categoryName: "GM Pool",
    scenario: {
      btcPrice: 60000,
      btcChange: -40,
      hf: 1.18,
      ltv: 72,
      debt: 30000,
      portfolio: { growth: { value: 43200, pct: 52, target: 60 }, stability: { value: 40000, pct: 48, target: 40 } },
      yieldZone: { gm: { value: 9300, pct: 40 }, clmm: { value: 0, pct: 0, rangeLow: 0, rangeHigh: 0 }, reserve: { value: 0, pct: 0 } }
    },
    question: "–ü–∞–¥–µ–Ω–∏–µ -40%. GM Pool –ø–æ—Ç–µ—Ä—è–ª ~22%. –ö–∞–∫–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ?",
    options: [
      { id: "a", text: "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ ‚Äî –Ω–∏–∫–∞–∫–∏—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π", correct: true },
      { id: "b", text: "–°—Ä–æ—á–Ω–æ –ø—Ä–æ–¥–∞—Ç—å GM –∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ –∑–∞–ª–æ–≥", correct: false },
      { id: "c", text: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Stability –¥–ª—è –ø–æ–∫—É–ø–∫–∏ GM", correct: false },
      { id: "d", text: "–ó–∞–∫—Ä—ã—Ç—å —á–∞—Å—Ç—å –¥–æ–ª–≥–∞ –∏–∑ Stability", correct: false }
    ]
  },
  {
    id: 4,
    category: "gm",
    categoryName: "GM Pool",
    scenario: {
      btcPrice: 110000,
      btcChange: 10,
      hf: 1.87,
      ltv: 45,
      debt: 30000,
      portfolio: { growth: { value: 66000, pct: 62, target: 60 }, stability: { value: 40000, pct: 38, target: 40 } },
      yieldZone: { gm: { value: 12600, pct: 40 }, clmm: { value: 9450, pct: 30, rangeLow: 85000, rangeHigh: 105000 }, reserve: { value: 9000, pct: 30 } }
    },
    question: "–†–æ—Å—Ç +10%. GM Pool –≤—ã—Ä–æ—Å –Ω–∞ ~5%. –ß—Ç–æ –¥–µ–ª–∞—Ç—å?",
    options: [
      { id: "a", text: "–î–µ—Ä–∂–∞—Ç—å –ø–æ–∑–∏—Ü–∏—é, –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å", correct: true },
      { id: "b", text: "–ü—Ä–æ–¥–∞—Ç—å GM –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–±—ã–ª—å –≤ USDC", correct: false },
      { id: "c", text: "–ü—Ä–æ–¥–∞—Ç—å GM ‚Üí –∫—É–ø–∏—Ç—å BTC –≤ –∑–∞–ª–æ–≥", correct: false },
      { id: "d", text: "–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –ø—Ä–∏–±—ã–ª—å –≤ Stability Zone", correct: false }
    ]
  },

  // CLMM questions (4)
  {
    id: 5,
    category: "clmm",
    categoryName: "CLMM",
    scenario: {
      btcPrice: 85000,
      btcChange: -15,
      hf: 1.45,
      ltv: 59,
      debt: 30000,
      portfolio: { growth: { value: 51000, pct: 56, target: 60 }, stability: { value: 40000, pct: 44, target: 40 } },
      yieldZone: { gm: { value: 10800, pct: 40 }, clmm: { value: 9000, pct: 30, rangeLow: 85000, rangeHigh: 105000, reached: true }, reserve: { value: 9000, pct: 30 } }
    },
    question: "CLMM #1 –¥–æ—Å—Ç–∏–≥–ª–∞ –Ω–∏–∂–Ω–µ–π –≥—Ä–∞–Ω–∏—Ü—ã —Ä–µ–Ω–∂–∞. –ß—Ç–æ –¥–µ–ª–∞—Ç—å?",
    options: [
      { id: "a", text: "–ó–∞–∫—Ä—ã—Ç—å CLMM ‚Üí BTC –≤ –∑–∞–ª–æ–≥ ‚Üí –æ—Ç–∫—Ä—ã—Ç—å CLMM #2 –∏–∑ Reserve", correct: true },
      { id: "b", text: "–ó–∞–∫—Ä—ã—Ç—å CLMM ‚Üí BTC –≤ –∑–∞–ª–æ–≥ ‚Üí Reserve –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å", correct: false },
      { id: "c", text: "–û—Å—Ç–∞–≤–∏—Ç—å CLMM, –æ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è", correct: false },
      { id: "d", text: "–ó–∞–∫—Ä—ã—Ç—å CLMM ‚Üí –≤—Å—ë –Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø–æ–≥–∞—à–µ–Ω–∏–µ –¥–æ–ª–≥–∞", correct: false }
    ]
  },
  {
    id: 6,
    category: "clmm",
    categoryName: "CLMM",
    scenario: {
      btcPrice: 70000,
      btcChange: -30,
      hf: 1.21,
      ltv: 70,
      debt: 30000,
      portfolio: { growth: { value: 42700, pct: 52, target: 60 }, stability: { value: 28000, pct: 48, target: 40 } },
      yieldZone: { gm: { value: 13500, pct: 45 }, clmm: { value: 9000, pct: 30, rangeLow: 72250, rangeHigh: 89250, reached: true }, reserve: { value: 0, pct: 0 } }
    },
    question: "CLMM #2 –∑–∞–∫—Ä—ã–ª–∞—Å—å, Reserve = 0. –ß—Ç–æ –¥–µ–ª–∞—Ç—å?",
    options: [
      { id: "a", text: "CLMM ‚Üí BTC –≤ –∑–∞–ª–æ–≥. STOP ‚Äî –±–æ–ª—å—à–µ CLMM –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ–º", correct: true },
      { id: "b", text: "CLMM ‚Üí BTC –≤ –∑–∞–ª–æ–≥ ‚Üí –≤–∑—è—Ç—å –∏–∑ Stability –¥–ª—è CLMM #3", correct: false },
      { id: "c", text: "CLMM ‚Üí BTC –≤ –∑–∞–ª–æ–≥ ‚Üí —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ–ª–≥ –¥–ª—è CLMM #3", correct: false },
      { id: "d", text: "–î–µ—Ä–∂–∞—Ç—å CLMM, –∂–¥–∞—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã", correct: false }
    ]
  },
  {
    id: 7,
    category: "clmm",
    categoryName: "CLMM",
    scenario: {
      btcPrice: 85000,
      btcChange: -15,
      hf: 1.45,
      ltv: 59,
      debt: 30000,
      portfolio: { growth: { value: 51000, pct: 56, target: 60 }, stability: { value: 40000, pct: 44, target: 40 } },
      yieldZone: { gm: { value: 21000, pct: 70 }, clmm: { value: 0, pct: 0, rangeLow: 0, rangeHigh: 0 }, reserve: { value: 9000, pct: 30 } }
    },
    question: "CLMM –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ = 0%. –ü–∞–¥–µ–Ω–∏–µ -15%. –ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å Reserve?",
    options: [
      { id: "a", text: "Reserve ‚Üí –∫—É–ø–∏—Ç—å GM —Ç–æ–∫–µ–Ω—ã", correct: true },
      { id: "b", text: "Reserve ‚Üí –æ—Ç–∫—Ä—ã—Ç—å CLMM –ø–æ–∑–∏—Ü–∏—é", correct: false },
      { id: "c", text: "Reserve ‚Üí –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤ Stability Zone", correct: false },
      { id: "d", text: "Reserve ‚Üí –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å", correct: false }
    ]
  },
  {
    id: 8,
    category: "clmm",
    categoryName: "CLMM",
    scenario: {
      btcPrice: 90000,
      btcChange: -10,
      hf: 1.51,
      ltv: 56,
      debt: 30000,
      portfolio: { growth: { value: 54000, pct: 57, target: 60 }, stability: { value: 40000, pct: 43, target: 40 } },
      yieldZone: { gm: { value: 11200, pct: 40 }, clmm: { value: 8600, pct: 30, rangeLow: 85000, rangeHigh: 105000 }, reserve: { value: 9000, pct: 30 } }
    },
    question: "–ü–∞–¥–µ–Ω–∏–µ -10%. CLMM –µ—â—ë –≤–Ω—É—Ç—Ä–∏ —Ä–µ–Ω–∂–∞. –ß—Ç–æ –¥–µ–ª–∞—Ç—å?",
    options: [
      { id: "a", text: "–ù–∏—á–µ–≥–æ ‚Äî CLMM —Ä–∞–±–æ—Ç–∞–µ—Ç, –∂–¥—ë–º –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è", correct: true },
      { id: "b", text: "–ü—Ä–µ–≤–µ–Ω—Ç–∏–≤–Ω–æ –∑–∞–∫—Ä—ã—Ç—å CLMM –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å", correct: false },
      { id: "c", text: "–°—É–∑–∏—Ç—å —Ä–µ–Ω–∂ –¥–ª—è –±–æ–ª—å—à–µ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏", correct: false },
      { id: "d", text: "–î–æ–±–∞–≤–∏—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞ –≤ CLMM –∏–∑ Reserve", correct: false }
    ]
  },

  // Stability Zone questions (3)
  {
    id: 9,
    category: "stability",
    categoryName: "Stability Zone",
    scenario: {
      btcPrice: 70000,
      btcChange: -30,
      hf: 1.21,
      ltv: 70,
      debt: 30000,
      portfolio: { growth: { value: 42000, pct: 51, target: 60 }, stability: { value: 40000, pct: 49, target: 40 } },
      yieldZone: { gm: { value: 15200, pct: 51 }, clmm: { value: 0, pct: 0, rangeLow: 0, rangeHigh: 0 }, reserve: { value: 0, pct: 0 } }
    },
    question: "–ü–∞–¥–µ–Ω–∏–µ -30%. –°–∫–æ–ª—å–∫–æ Stability Zone –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?",
    options: [
      { id: "a", text: "30% –æ—Ç –Ω–∞—á–∞–ª—å–Ω–æ–π Stability ‚Üí –∫—É–ø–∏—Ç—å GM", correct: true },
      { id: "b", text: "50% –æ—Ç –Ω–∞—á–∞–ª—å–Ω–æ–π Stability ‚Üí –∫—É–ø–∏—Ç—å GM", correct: false },
      { id: "c", text: "100% Stability ‚Üí –≤—Å—ë –≤ GM", correct: false },
      { id: "d", text: "0% ‚Äî –¥–µ—Ä–∂–∞—Ç—å Stability –Ω–∞ —Å–ª—É—á–∞–π –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –ø–∞–¥–µ–Ω–∏—è", correct: false }
    ]
  },
  {
    id: 10,
    category: "stability",
    categoryName: "Stability Zone",
    scenario: {
      btcPrice: 50000,
      btcChange: -50,
      hf: 1.06,
      ltv: 80,
      debt: 30000,
      portfolio: { growth: { value: 37500, pct: 48, target: 60 }, stability: { value: 28000, pct: 52, target: 40 } },
      yieldZone: { gm: { value: 17000, pct: 57 }, clmm: { value: 0, pct: 0, rangeLow: 0, rangeHigh: 0 }, reserve: { value: 0, pct: 0 } }
    },
    question: "–ü–∞–¥–µ–Ω–∏–µ -50%. –ö—É–¥–∞ –Ω–∞–ø—Ä–∞–≤–∏—Ç—å 40% Stability?",
    options: [
      { id: "a", text: "40% Stability ‚Üí –∫—É–ø–∏—Ç—å GM —Ç–æ–∫–µ–Ω—ã", correct: true },
      { id: "b", text: "40% Stability ‚Üí –∫—É–ø–∏—Ç—å BTC –Ω–∞–ø—Ä—è–º—É—é –≤ –∑–∞–ª–æ–≥", correct: false },
      { id: "c", text: "40% Stability ‚Üí –ø–æ–≥–∞—Å–∏—Ç—å —á–∞—Å—Ç—å –¥–æ–ª–≥–∞", correct: false },
      { id: "d", text: "–ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ‚Äî HF —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–π", correct: false }
    ]
  },
  {
    id: 11,
    category: "stability",
    categoryName: "Stability Zone",
    scenario: {
      btcPrice: 60000,
      btcChange: -40,
      hf: 1.18,
      ltv: 72,
      debt: 30000,
      portfolio: { growth: { value: 41400, pct: 51, target: 60 }, stability: { value: 40000, pct: 49, target: 40 } },
      yieldZone: { gm: { value: 14000, pct: 47 }, clmm: { value: 0, pct: 0, rangeLow: 0, rangeHigh: 0 }, reserve: { value: 0, pct: 0 } }
    },
    question: "–ü–∞–¥–µ–Ω–∏–µ -40%. –ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å–æ Stability Zone?",
    options: [
      { id: "a", text: "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ ‚Äî –∂–¥–∞—Ç—å —É—Ä–æ–≤–Ω—è -50% –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π", correct: true },
      { id: "b", text: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 30% –¥–ª—è –ø–æ–∫—É–ø–∫–∏ GM", correct: false },
      { id: "c", text: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 50% –¥–ª—è –ø–æ–∫—É–ø–∫–∏ BTC", correct: false },
      { id: "d", text: "–ü–æ–≥–∞—Å–∏—Ç—å —á–∞—Å—Ç—å –¥–æ–ª–≥–∞ –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è HF", correct: false }
    ]
  },

  // DCA questions (4)
  {
    id: 12,
    category: "dca",
    categoryName: "DCA —Ä–µ—à–µ–Ω–∏—è",
    scenario: {
      btcPrice: 92000,
      btcChange: -8,
      hf: 1.35,
      ltv: 63,
      debt: 30000,
      portfolio: { growth: { value: 55200, pct: 58, target: 60 }, stability: { value: 35000, pct: 37, target: 40 } },
      yieldZone: { gm: { value: 11500, pct: 38 }, clmm: { value: 8800, pct: 29, rangeLow: 85000, rangeHigh: 105000 }, reserve: { value: 9000, pct: 30 } }
    },
    question: "HF = 1.35 (–Ω–∏–∑–∫–∏–π). –ü–æ–ª—É—á–∏–ª–∏ DCA $1,000. –ö—É–¥–∞ –Ω–∞–ø—Ä–∞–≤–∏—Ç—å?",
    options: [
      { id: "a", text: "–í Stability Zone ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –Ω–∏–∑–∫–æ–º HF", correct: true },
      { id: "b", text: "–í Yield Zone ‚Äî –¥–æ–∫—É–ø–∏—Ç—å GM", correct: false },
      { id: "c", text: "–í Growth Zone ‚Äî –∫—É–ø–∏—Ç—å BTC –≤ –∑–∞–ª–æ–≥", correct: false },
      { id: "d", text: "–ü–æ–≥–∞—Å–∏—Ç—å —á–∞—Å—Ç—å –¥–æ–ª–≥–∞", correct: false }
    ]
  },
  {
    id: 13,
    category: "dca",
    categoryName: "DCA —Ä–µ—à–µ–Ω–∏—è",
    scenario: {
      btcPrice: 105000,
      btcChange: 5,
      hf: 1.80,
      ltv: 47,
      debt: 30000,
      portfolio: { growth: { value: 63000, pct: 61, target: 60 }, stability: { value: 40000, pct: 39, target: 40 } },
      yieldZone: { gm: { value: 3000, pct: 10 }, clmm: { value: 0, pct: 0, rangeLow: 0, rangeHigh: 0 }, reserve: { value: 0, pct: 0 } }
    },
    question: "HF = 1.80. Yield Zone –ø–æ—á—Ç–∏ –ø—É—Å—Ç–∞ (10% –æ—Ç –¥–æ–ª–≥–∞). DCA $1,000?",
    options: [
      { id: "a", text: "–í Yield Zone ‚Äî –≤–æ—Å–ø–æ–ª–Ω–∏—Ç—å GM –ø–æ–∑–∏—Ü–∏—é", correct: true },
      { id: "b", text: "–í Stability Zone", correct: false },
      { id: "c", text: "–í Growth Zone ‚Äî –∫—É–ø–∏—Ç—å BTC", correct: false },
      { id: "d", text: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ USDC –æ—Ç–¥–µ–ª—å–Ω–æ", correct: false }
    ]
  },
  {
    id: 14,
    category: "dca",
    categoryName: "DCA —Ä–µ—à–µ–Ω–∏—è",
    scenario: {
      btcPrice: 95000,
      btcChange: -5,
      hf: 1.60,
      ltv: 53,
      debt: 30000,
      portfolio: { growth: { value: 57000, pct: 74, target: 60 }, stability: { value: 20000, pct: 26, target: 40 } },
      yieldZone: { gm: { value: 11000, pct: 37 }, clmm: { value: 9000, pct: 30, rangeLow: 85000, rangeHigh: 105000 }, reserve: { value: 9000, pct: 30 } }
    },
    question: "HF = 1.60. Stability = 26% (—Ü–µ–ª—å 40%). DCA $1,000?",
    options: [
      { id: "a", text: "–í Stability Zone ‚Äî –≤–æ—Å–ø–æ–ª–Ω–∏—Ç—å –¥–æ —Ü–µ–ª–µ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è", correct: true },
      { id: "b", text: "–í Yield Zone ‚Äî —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å", correct: false },
      { id: "c", text: "–í Growth Zone ‚Äî –±–æ–ª—å—à–µ BTC", correct: false },
      { id: "d", text: "–†–∞–∑–¥–µ–ª–∏—Ç—å 50/50 –º–µ–∂–¥—É Stability –∏ Yield", correct: false }
    ]
  },
  {
    id: 15,
    category: "dca",
    categoryName: "DCA —Ä–µ—à–µ–Ω–∏—è",
    scenario: {
      btcPrice: 100000,
      btcChange: 0,
      hf: 1.70,
      ltv: 50,
      debt: 30000,
      portfolio: { growth: { value: 60000, pct: 60, target: 60 }, stability: { value: 40000, pct: 40, target: 40 } },
      yieldZone: { gm: { value: 12000, pct: 40 }, clmm: { value: 9000, pct: 30, rangeLow: 85000, rangeHigh: 105000 }, reserve: { value: 9000, pct: 30 } }
    },
    question: "–í—Å—ë –≤ –±–∞–ª–∞–Ω—Å–µ: HF = 1.70, Growth/Stability = 60/40, Yield Zone = 100% –æ—Ç –∑–∞–π–º–∞. DCA $1,000?",
    options: [
      { id: "a", text: "–í Stability Zone ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –±–∞–ª–∞–Ω—Å", correct: true },
      { id: "b", text: "–í Growth Zone ‚Äî —É–≤–µ–ª–∏—á–∏—Ç—å BTC", correct: false },
      { id: "c", text: "–í Yield Zone ‚Äî —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å", correct: false },
      { id: "d", text: "–ù–µ –≤–∞–∂–Ω–æ –∫—É–¥–∞ ‚Äî –≤—Å—ë –≤ –±–∞–ª–∞–Ω—Å–µ", correct: false }
    ]
  },

  // DeFi income questions (1)
  {
    id: 16,
    category: "defi",
    categoryName: "DeFi –¥–æ—Ö–æ–¥—ã",
    scenario: {
      btcPrice: 100000,
      btcChange: 0,
      hf: 1.70,
      ltv: 50,
      debt: 30000,
      portfolio: { growth: { value: 60000, pct: 60, target: 60 }, stability: { value: 40000, pct: 40, target: 40 } },
      yieldZone: { gm: { value: 12000, pct: 40 }, clmm: { value: 9000, pct: 30, rangeLow: 85000, rangeHigh: 105000 }, reserve: { value: 9000, pct: 30 } },
      income: { usdc: 500, btc: 0.005, btcValue: 500 }
    },
    question: "CLMM –∑–∞ –º–µ—Å—è—Ü –ø—Ä–∏–Ω–µ—Å–ª–∞ $500 USDC + 0.005 BTC ($500). –ö—É–¥–∞ –Ω–∞–ø—Ä–∞–≤–∏—Ç—å?",
    options: [
      { id: "a", text: "–í—Å—ë –≤ Growth Zone (–∑–∞–ª–æ–≥) ‚Äî USDC ‚Üí BTC ‚Üí –∑–∞–ª–æ–≥", correct: true },
      { id: "b", text: "USDC ‚Üí Stability, BTC ‚Üí Growth", correct: false },
      { id: "c", text: "–†–µ–∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ –≤ CLMM", correct: false },
      { id: "d", text: "USDC ‚Üí –ø–æ–≥–∞—Å–∏—Ç—å –¥–æ–ª–≥, BTC ‚Üí Growth", correct: false }
    ]
  }
];

// Quiz state
let currentQuestions = [];
let currentQuestionIndex = 0;
let answers = [];
let errors = { gm: 0, clmm: 0, stability: 0, dca: 0, defi: 0 };

const categoryNames = {
  gm: "GM Pool",
  clmm: "CLMM",
  stability: "Stability Zone",
  dca: "DCA —Ä–µ—à–µ–Ω–∏—è",
  defi: "DeFi –¥–æ—Ö–æ–¥—ã"
};

function onAuthSuccess() {
  // Show start screen
}

function startQuiz() {
  // Reset state
  currentQuestionIndex = 0;
  answers = [];
  errors = { gm: 0, clmm: 0, stability: 0, dca: 0, defi: 0 };

  // Select 10 random questions
  const shuffled = [...allQuestions].sort(() => Math.random() - 0.5);
  currentQuestions = shuffled.slice(0, 10);

  // Show quiz screen
  document.getElementById('startScreen').style.display = 'none';
  document.getElementById('quizScreen').style.display = 'block';
  document.getElementById('resultCard').classList.remove('visible');

  renderQuestion();
}

function renderQuestion() {
  const q = currentQuestions[currentQuestionIndex];
  const s = q.scenario;

  // Update progress
  document.getElementById('progressText').textContent = `–í–æ–ø—Ä–æ—Å ${currentQuestionIndex + 1}/10`;
  document.getElementById('progressFill').style.width = `${(currentQuestionIndex + 1) * 10}%`;
  document.getElementById('categoryText').textContent = q.categoryName;

  // Build scenario HTML
  let html = `
    <div class="scenario-header">
      <div class="scenario-title">üìä –°—Ü–µ–Ω–∞—Ä–∏–π</div>
      <div class="btc-price">
        <div class="price">BTC: ${fmtUSD(s.btcPrice)}</div>
        <div class="change ${s.btcChange < 0 ? 'negative' : s.btcChange > 0 ? 'positive' : 'neutral'}">
          ${s.btcChange >= 0 ? '+' : ''}${s.btcChange}% –æ—Ç $100,000
        </div>
      </div>
    </div>

    <div class="metrics-row">
      <div class="metric-box">
        <div class="label">Health Factor</div>
        <div class="value ${s.hf > 1.5 ? 'safe' : s.hf > 1.2 ? 'warning' : 'danger'}">${fmt(s.hf, 2)}</div>
      </div>
      <div class="metric-box">
        <div class="label">LTV</div>
        <div class="value ${s.ltv > 75 ? 'danger' : s.ltv > 65 ? 'warning' : ''}">${s.ltv}%</div>
      </div>
      <div class="metric-box">
        <div class="label">Debt</div>
        <div class="value">${fmtUSD(s.debt)}</div>
      </div>
    </div>

    <div class="portfolio-section">
      <h4>üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–µ–ª—è (Growth / Stability):</h4>
      <div class="portfolio-bar">
        <span class="name">Growth</span>
        <div class="bar-container">
          <div class="bar-fill growth" style="width: ${s.portfolio.growth.pct}%"></div>
        </div>
        <span class="stats"><span class="pct">${s.portfolio.growth.pct}%</span> ‚îÇ ${fmtUSD(s.portfolio.growth.value)}</span>
      </div>
      <div class="portfolio-bar">
        <span class="name">Stability</span>
        <div class="bar-container">
          <div class="bar-fill stability" style="width: ${s.portfolio.stability.pct}%"></div>
        </div>
        <span class="stats"><span class="pct">${s.portfolio.stability.pct}%</span> ‚îÇ ${fmtUSD(s.portfolio.stability.value)}</span>
      </div>
      <div class="target-info">
        <span class="label">üéØ –¶–µ–ª–µ–≤–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:</span>
        <b>Growth ${s.portfolio.growth.target}% / Stability ${s.portfolio.stability.target}%</b>
      </div>
    </div>

    <div class="portfolio-section">
      <h4>üí∞ Yield Zone (–∏–∑ –∑–∞–π–º–∞ ${fmtUSD(s.debt)}):</h4>
      <div class="portfolio-bar">
        <span class="name">GM Pool</span>
        <div class="bar-container">
          <div class="bar-fill gm" style="width: ${s.yieldZone.gm.pct}%"></div>
        </div>
        <span class="stats"><span class="pct">${s.yieldZone.gm.pct}%</span> ‚îÇ ${fmtUSD(s.yieldZone.gm.value)}</span>
      </div>
  `;

  if (s.yieldZone.clmm.pct > 0 || s.yieldZone.clmm.rangeLow > 0) {
    html += `
      <div class="portfolio-bar">
        <span class="name">CLMM</span>
        <div class="bar-container">
          <div class="bar-fill clmm" style="width: ${s.yieldZone.clmm.pct}%"></div>
        </div>
        <span class="stats"><span class="pct">${s.yieldZone.clmm.pct}%</span> ‚îÇ ${fmtUSD(s.yieldZone.clmm.value)}</span>
      </div>
    `;
    if (s.yieldZone.clmm.rangeLow > 0) {
      html += `
        <div class="clmm-range ${s.yieldZone.clmm.reached ? 'reached' : ''}">
          ‚îî‚îÄ –†–µ–Ω–∂: ${fmtUSD(s.yieldZone.clmm.rangeLow)} ‚Äî ${fmtUSD(s.yieldZone.clmm.rangeHigh)}
          ${s.yieldZone.clmm.reached ? ' (–¥–æ—Å—Ç–∏–≥–Ω—É—Ç!)' : ''}
        </div>
      `;
    }
  }

  html += `
      <div class="portfolio-bar">
        <span class="name">Reserve</span>
        <div class="bar-container">
          <div class="bar-fill reserve" style="width: ${s.yieldZone.reserve.pct}%"></div>
        </div>
        <span class="stats"><span class="pct">${s.yieldZone.reserve.pct}%</span> ‚îÇ ${fmtUSD(s.yieldZone.reserve.value)}</span>
      </div>
    </div>
  `;

  // Add income info for DeFi question
  if (s.income) {
    html += `
      <div class="income-info">
        <div class="title">üí∞ –î–æ—Ö–æ–¥ –∑–∞ –º–µ—Å—è—Ü:</div>
        <div class="item"><span>USDC (–∫–æ–º–∏—Å—Å–∏–∏)</span><span>${fmtUSD(s.income.usdc)}</span></div>
        <div class="item"><span>BTC (${s.income.btc} BTC)</span><span>${fmtUSD(s.income.btcValue)}</span></div>
        <div class="item" style="border-top: 1px solid #444; padding-top: 5px; margin-top: 5px;">
          <span><b>–ò—Ç–æ–≥–æ</b></span><span><b>${fmtUSD(s.income.usdc + s.income.btcValue)}</b></span>
        </div>
      </div>
    `;
  }

  html += `
    <div class="question-box">
      <span class="question-icon">‚ùì</span>
      <span class="question-text">${q.question}</span>
    </div>
  `;

  document.getElementById('scenarioCard').innerHTML = html;

  // Shuffle options and assign new letters (A, B, C, D)
  const shuffledOpts = [...q.options].sort(() => Math.random() - 0.5);
  const letters = ['a', 'b', 'c', 'd'];
  shuffledOpts.forEach((opt, i) => {
    opt.displayLetter = letters[i];
  });

  // Store shuffled options for answer checking
  currentQuestions[currentQuestionIndex].shuffledOptions = shuffledOpts;

  // Render options as 2x2 table (A,B left column, C,D right column)
  const optionsHtml = `
    <div class="options-table">
      <div class="options-row">
        <div class="options-cell">
          <button class="option-btn" data-idx="0" onclick="selectOption(0)">
            <span class="option-letter">${shuffledOpts[0].displayLetter.toUpperCase()}</span>
            <span class="option-text">${shuffledOpts[0].text}</span>
          </button>
        </div>
        <div class="options-cell">
          <button class="option-btn" data-idx="2" onclick="selectOption(2)">
            <span class="option-letter">${shuffledOpts[2].displayLetter.toUpperCase()}</span>
            <span class="option-text">${shuffledOpts[2].text}</span>
          </button>
        </div>
      </div>
      <div class="options-row">
        <div class="options-cell">
          <button class="option-btn" data-idx="1" onclick="selectOption(1)">
            <span class="option-letter">${shuffledOpts[1].displayLetter.toUpperCase()}</span>
            <span class="option-text">${shuffledOpts[1].text}</span>
          </button>
        </div>
        <div class="options-cell">
          <button class="option-btn" data-idx="3" onclick="selectOption(3)">
            <span class="option-letter">${shuffledOpts[3].displayLetter.toUpperCase()}</span>
            <span class="option-text">${shuffledOpts[3].text}</span>
          </button>
        </div>
      </div>
    </div>
  `;

  document.getElementById('optionsList').innerHTML = optionsHtml;
  document.getElementById('nextBtn').classList.remove('visible');
}

function selectOption(optionIdx) {
  const q = currentQuestions[currentQuestionIndex];
  const shuffledOpts = q.shuffledOptions;
  const selectedOption = shuffledOpts[optionIdx];

  // Find correct option index in shuffled array
  const correctIdx = shuffledOpts.findIndex(o => o.correct);

  // Store answer
  answers.push({
    questionId: q.id,
    category: q.category,
    selected: optionIdx,
    correct: selectedOption.correct
  });

  // Track errors
  if (!selectedOption.correct) {
    errors[q.category]++;
  }

  // Update UI
  const buttons = document.querySelectorAll('.option-btn');
  buttons.forEach(btn => {
    btn.classList.add('disabled');
    const btnIdx = parseInt(btn.dataset.idx);
    if (btnIdx === correctIdx) {
      btn.classList.add('correct');
    } else if (btnIdx === optionIdx && !selectedOption.correct) {
      btn.classList.add('incorrect');
    }
  });

  // Show next button
  const nextBtn = document.getElementById('nextBtn');
  if (currentQuestionIndex < 9) {
    nextBtn.textContent = '–°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å ‚Üí';
  } else {
    nextBtn.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã ‚Üí';
  }
  nextBtn.classList.add('visible');
}

function nextQuestion() {
  currentQuestionIndex++;

  if (currentQuestionIndex >= 10) {
    showResults();
  } else {
    renderQuestion();
  }
}

function showResults() {
  document.getElementById('quizScreen').style.display = 'none';

  const correctCount = answers.filter(a => a.correct).length;
  const score = `${correctCount}/10`;

  let message, messageClass;
  if (correctCount === 10) {
    message = 'üèÜ –û—Ç–ª–∏—á–Ω–æ! –í—ã –≥–æ—Ç–æ–≤—ã –∫ —Ä–µ–∞–ª—å–Ω—ã–º —Ä–µ—à–µ–Ω–∏—è–º';
    messageClass = 'excellent';
  } else if (correctCount >= 8) {
    message = '‚úÖ –•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—à–∏–±–æ–∫';
    messageClass = 'good';
  } else if (correctCount >= 6) {
    message = '‚ö†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª';
    messageClass = 'average';
  } else {
    message = 'üìö –ü—Ä–æ–π–¥–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∑–∞–Ω–æ–≤–æ –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–æ–º';
    messageClass = 'poor';
  }

  document.getElementById('resultScore').textContent = score;
  document.getElementById('resultMessage').textContent = message;
  document.getElementById('resultMessage').className = 'result-message ' + messageClass;

  // Build errors list
  let errorsHtml = '';
  let hasErrors = false;
  for (const [cat, count] of Object.entries(errors)) {
    if (count > 0) {
      hasErrors = true;
      errorsHtml += `
        <div class="error-category">
          <span class="name">üî∏ ${categoryNames[cat]}</span>
          <span class="count">${count} ${count === 1 ? '–æ—à–∏–±–∫–∞' : '–æ—à–∏–±–∫–∏'}</span>
        </div>
      `;
    }
  }

  if (hasErrors) {
    document.getElementById('errorsList').innerHTML = errorsHtml;
    document.getElementById('errorsSection').style.display = 'block';
  } else {
    document.getElementById('errorsSection').style.display = 'none';
  }

  // Update image card
  document.getElementById('imgScore').textContent = score;
  document.getElementById('imgMessage').textContent = message;
  document.getElementById('imgMessage').className = 'message ' + messageClass;

  if (hasErrors) {
    document.getElementById('imgErrorsList').innerHTML = errorsHtml.replace(/error-category/g, 'error-item');
    document.getElementById('imgErrors').style.display = 'block';
  } else {
    document.getElementById('imgErrors').style.display = 'none';
  }

  document.getElementById('resultCard').classList.add('visible');
}

function restartQuiz() {
  document.getElementById('resultCard').classList.remove('visible');
  document.getElementById('startScreen').style.display = 'block';
}

async function downloadImage() {
  const card = document.getElementById('resultImageCard');
  card.style.top = '0';
  card.style.left = '0';
  card.style.zIndex = '9999';

  try {
    const canvas = await html2canvas(card, {
      backgroundColor: '#0f0f23',
      scale: 2
    });

    const link = document.createElement('a');
    link.download = 'cgs-quiz-result.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
  } finally {
    card.style.top = '-9999px';
    card.style.left = '-9999px';
    card.style.zIndex = '';
  }
}

async function copyImage() {
  const card = document.getElementById('resultImageCard');
  card.style.top = '0';
  card.style.left = '0';
  card.style.zIndex = '9999';

  try {
    const canvas = await html2canvas(card, {
      backgroundColor: '#0f0f23',
      scale: 2
    });

    canvas.toBlob(async (blob) => {
      try {
        await navigator.clipboard.write([
          new ClipboardItem({ 'image/png': blob })
        ]);
        showToast('–ö–∞—Ä—Ç–∏–Ω–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
      } catch (err) {
        // Fallback: download instead
        const link = document.createElement('a');
        link.download = 'cgs-quiz-result.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
        showToast('–°–∫–∞—á–∞–Ω–æ (–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)');
      }
    });
  } finally {
    card.style.top = '-9999px';
    card.style.left = '-9999px';
    card.style.zIndex = '';
  }
}

function showToast(message) {
  const toast = document.getElementById('toast');
  toast.textContent = message;
  toast.classList.add('visible');
  setTimeout(() => toast.classList.remove('visible'), 2000);
}

// Initialize next button click handler
document.getElementById('nextBtn').onclick = nextQuestion;
</script>
</body>
</html>
